{
	acme_dns cloudflare {env.CLOUDFLARE_API_TOKEN}
	email {env.ACME_ACCOUNT}
}

reeceiriye.me {
	# --- Static assets ---
	handle /static/* {
		root * /app/static
		file_server
		header Cache-Control "public, max-age=86400"

		# Static-specific rate limit
		rate_limit {
			zone static_per_ip {
				key {http.request.header.CF-Connecting-IP}
				window 1m
				events 1200
				burst 50
			}
			log_key
		}
	}

	# --- Dynamic routes (proxied to Go server) ---
	handle {
		reverse_proxy htmx-portfolio:8080 {
			header_up X-Real-IP {http.reverse_proxy.upstream.address}
		}

		# Dynamic-specific rate limit
		rate_limit {
			zone per_ip {
				key {http.request.header.CF-Connecting-IP}
				window 1m
				events 70
				burst 10
			}
			log_key
		}
	}

	tls {
		protocols tls1.2 tls1.3
	}
}
